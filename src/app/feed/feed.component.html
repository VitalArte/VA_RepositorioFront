<div class="container-fluid cobrinha">
  <div class="row">
    <div class="col mt-5">
      <div class="botoes d-flex justify-content-center">
        <button class="btn sidenav-btn text-white fs-12 ms-1 me-2" data-bs-toggle="modal"
          data-bs-target="#novaPostagem">Nova
          postagem</button>
        <a class="btn sidenav-btn fs-12 text-white ms-1" href="">Minhas postagens</a>
      </div>
      <app-barrauser></app-barrauser>
    </div>
    <div class="mt-2 col-8">

      <!-- todo Row que contém as postagens -->

      <div class="container mb-5 mt-5" id="postagens">
        <div *ngFor='let postagem of listaPostagem' class="card bg-light my-5 arredondada">
          <div class="card-header d-flex py-2 arredondada-header">
            <div class="p-0">
              <img class="rounded-circle img-size-user" src="{{postagem.usuario.foto}}" alt="Foto do autor do post">
            </div>
            <p class="align-self-center">{{postagem.usuario.nome}}</p>
            <p>{{postagem.data | date: 'dd/MM/yyyy'}}</p>
            <h5 class="ms-auto align-self-center">{{postagem.titulo}}</h5>
          </div>
          <div class="card-body d-flex flex-column">
            <img class="mx-auto my-2" style="max-width: 75%;" *ngIf='postagem.multimidia != null'
              src="{{postagem.multimidia}}" alt="Foto de postagem">
            <p class="card-text my-2">{{postagem.corpo}}</p>
            <div class="hashtags text-end my-2">{{postagem.hashtags}}
            </div>
            <hr class="m-0">
          </div>
          <div class="card-footer d-flex">
            <img src="../../assets/imagens/palminhas.png" alt="">
            <p class="ms-3"><strong>{{postagem.curtidas}}</strong> palminhas</p>
            <a *ngIf='postagem.usuario.id == usuario.id' (click)='getByIdPostagens(postagem.id)'
              class="btn btn-azul ms-auto py-2 text-white" data-bs-toggle="modal"
              data-bs-target="#editarPostagem">Editar</a>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="nav-minhasPostagens" role="tabpanel" aria-labelledby="nav-minhasPostagens-tab">
        Minhas postagens
      </div>

      <div class="tab-pane fade" id="nav-postagemTema" role="tabpanel" aria-labelledby="nav-postagemTema-tab">
        Postagens por tema
      </div>
    </div>
  </div>
</div>

<!-- ! Modal para fazer postagens -->

<!-- Modal -->
<div class="modal fade" id="novaPostagem" tabindex="-1" role="dialog" aria-labelledby="TituloModalCentralizado"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModalCentralizado">Nova Postagem</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Fechar">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <div class="form-group">
          <div class="mb-3">
            <label for="titulo">Título</label>
            <input [(ngModel)]='postagem.titulo' type="text" class="form-control" id="titulo"
              placeholder="Digite o título">
          </div>
          <div class="mb-3">
            <label for="midia">Foto</label>
            <input [(ngModel)]='postagem.multimidia' type="text" class="form-control" id="midia"
              placeholder="Deseja adicionar uma foto?">
          </div>
          <div class="mb-3">

            <label for="corpo">Corpo</label>
            <textarea class="form-control" name="corpo" [(ngModel)]='postagem.corpo' class="form-control" id="corpo"
              placeholder="Digite o corpo" rows="3"></textarea>
          </div>
          <div class="mb-3">

            <label for="hashtags">Hashtags</label>
            <input [(ngModel)]='postagem.hashtags' type="text" class="form-control" id="hashtags"
              placeholder="#musica #projetos #etc">
          </div>
          <div class="mb-3">

            <label for="texto">Escolha um tema <a *ngIf='usuario.tipoConta == "admin"' data-dismiss="modal"
                routerLink='/tema'>cadastre um novo</a>: </label>
            <select [(ngModel)]='tema.id' name="tema" id="tema" class="form-select form-control"
              (change)='getByIdTema(tema.id)'>
              <option *ngFor='let tema of listaTema' value="{{tema.id}}">{{tema.descricao}}</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" (click)='cadastrar()' data-bs-dismiss="modal" class="btn btn-success">Publicar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal: editar postagem -->
<div class="modal fade " id="editarPostagem" tabindex="-1" aria-labelledby="editarPostagemLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Editar Postagem</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="titulo" class="form-label">Título</label>
            <input [(ngModel)]='postagemEdit.titulo' type="text" class="form-control" name="titulo" id="titulo"
              aria-describedby="titulo" placeholder="Digite seu título">
          </div>
          <div class="mb-3">
            <label for="corpo" class="form-label">Corpo</label>
            <textarea [(ngModel)]='postagemEdit.corpo' name="corpo" id="corpo" cols="30" rows="5" class="form-control"
              placeholder="O corpo da postagem deve ter no mínimo 10 caracteres."></textarea>
          </div>
          <div class="mb-3">
            <label for="tema" class="form-label">Escolha um tema ou <a data-bs-dismiss="modal"
                routerLink="/tema">cadastre um novo</a>:</label>
            <select [(ngModel)]='temaEdit.id' name="tema" id="tema" class="form-select form-control"
              (change)='getByIdTema(postagemEdit.tema.id)'>
              <option *ngFor='let tema of listaTema' value="{{tema.id}}">{{tema.tema}}</option>
            </select>
          </div>
          <a data-bs-toggle="modal" data-bs-target="#apagarPostagem" data-bs-dismiss="modal" class="mb-3">Deseja apagar
            esta postagem?</a>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" data-bs-dismiss="modal" class="btn btn-primary"
          (click)='atualizarPostagem(postagemEdit.id)'>Salvar alterações</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal: apagar postagem -->
<div class="modal fade" id="apagarPostagem" tabindex="-1" aria-labelledby="apagarPostagemLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Apagar Postagem</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>
          Você tem certeza que deseja apagar a postagem <strong>{{postagemEdit.titulo}}</strong>?
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" data-bs-dismiss="modal" class="btn btn-primary" (click)='apagarPostagem()'>Apagar</button>
      </div>
    </div>
  </div>
</div>
